schemaVersion: '2.0.0'

metadataTest:
  exposedPorts: ['9080']
  entrypoint: ['npm']
  cmd: ['run', 'start:app']
  workdir: '/usr/src/app'
  user: 'node'

commandTests:
  - name: 'ğŸ”  node is installed'
    command: 'which'
    args: ['node']
    exitCode: 0
    expectedOutput: ['/usr/local/bin/node']
  - name: 'ğŸ”  node is version 18'
    command: 'node'
    args: ['--version']
    exitCode: 0
    expectedOutput: ['v18.']

fileContentTests:
  - name: 'ğŸ“¦ Package JSON'
    path: '/usr/src/app/package.json'
    expectedContents:
      [
        '.*"start:app": "export SERVER_PORT=9080 && node app\.js".*',
        '.*"name": "{{cookiecutter.project_slug}}",.*',
      ]

fileExistenceTests:
  - name: 'ğŸ“¦ Package JSON'
    path: '/usr/src/app/package.json'
    shouldExist: true
  - name: 'ğŸ“„ Swagger Document'
    path: '/usr/src/app/openapi.json'
    shouldExist: true
  - name: 'ğŸš‚ Express Server'
    path: '/usr/src/app/node_modules/express'
    shouldExist: true
  - name: 'ğŸ’¿ App entrypoint'
    path: '/usr/src/app/app.js'
    shouldExist: true
  - name: 'ğŸ“ Goss file'
    path: '/usr/src/app/goss.yaml'
    shouldExist: true
  - name: 'ğŸ—‚ï¸ App directory'
    path: '/usr/src/app'
    shouldExist: true
    permissions: 'drwxrwxr-x'
    uid: 1000
    gid: 0
    isExecutableBy: 'group'
